 TROUBLESHOOTING_CHATWOOT_EVOLUTION.md                                                                                                  ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ # Troubleshooting: Mensajes de Evolution API no aparecen en Chatwoot UI                                                                ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ **Fecha:** 2025-11-06                                                                                                                  ‚îÇ
‚îÇ **Stack:** Evolution API v2.3.6 + Chatwoot v4.1.0 + PostgreSQL (pgvector)                                                              ‚îÇ
‚îÇ **Problema:** Los mensajes de WhatsApp llegan a Evolution API y se guardan en la base de datos de Chatwoot, pero NO aparecen en la     ‚îÇ
‚îÇ interfaz de usuario.                                                                                                                   ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ ---                                                                                                                                    ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ ## üìã √çndice                                                                                                                           ‚îÇ
‚îÇ 1. [S√≠ntomas del Problema](#s√≠ntomas-del-problema)                                                                                     ‚îÇ
‚îÇ 2. [Proceso de Diagn√≥stico](#proceso-de-diagn√≥stico)                                                                                   ‚îÇ
‚îÇ 3. [Causa Ra√≠z](#causa-ra√≠z)                                                                                                           ‚îÇ
‚îÇ 4. [Soluci√≥n](#soluci√≥n)                                                                                                               ‚îÇ
‚îÇ 5. [Prevenci√≥n](#prevenci√≥n)                                                                                                           ‚îÇ
‚îÇ 6. [Referencias](#referencias)                                                                                                         ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ ---                                                                                                                                    ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ ## üö® S√≠ntomas del Problema                                                                                                            ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ ### Comportamiento observado:                                                                                                          ‚îÇ
‚îÇ - ‚úÖ Los mensajes de WhatsApp llegan a Evolution API (confirmado en logs)                                                               ‚îÇ
‚îÇ - ‚úÖ Evolution API procesa los mensajes correctamente                                                                                   ‚îÇ
‚îÇ - ‚úÖ Los mensajes se guardan en la base de datos de Chatwoot                                                                            ‚îÇ
‚îÇ - ‚ùå **Los mensajes NO aparecen en la interfaz de Chatwoot**                                                                            ‚îÇ
‚îÇ - ‚ùå El inbox aparece vac√≠o o muestra "No hay conversaciones activas en este grupo"                                                     ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ ### Configuraci√≥n inicial:                                                                                                             ‚îÇ
‚îÇ ```yaml                                                                                                                                ‚îÇ
‚îÇ # evolution.yaml (l√≠neas relevantes)                                                                                                   ‚îÇ
‚îÇ CHATWOOT_ENABLED=true                                                                                                                  ‚îÇ
‚îÇ CHATWOOT_MESSAGE_READ=true                                                                                                             ‚îÇ
‚îÇ CHATWOOT_MESSAGE_DELETE=true                                                                                                           ‚îÇ
‚îÇ ```                                                                                                                                    ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ ```json                                                                                                                                ‚îÇ
‚îÇ // Configuraci√≥n de instancia                                                                                                          ‚îÇ
‚îÇ {                                                                                                                                      ‚îÇ
‚îÇ   "enabled": true,                                                                                                                     ‚îÇ
‚îÇ   "accountId": "1",                                                                                                                    ‚îÇ
‚îÇ   "token": "maTyFdUJpnUfP3uXJQJDjDmQ",                                                                                                 ‚îÇ
‚îÇ   "url": "https://chatwoot.automatesolutions.tech"                                                                                     ‚îÇ
‚îÇ }                                                                                                                                      ‚îÇ
‚îÇ ```                                                                                                                                    ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ ---                                                                                                                                    ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ ## üîç Proceso de Diagn√≥stico                                                                                                           ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ ### Paso 1: Verificar configuraci√≥n de Evolution API                                                                                   ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ **Comando ejecutado:**                                                                                                                 ‚îÇ
‚îÇ ```bash                                                                                                                                ‚îÇ
‚îÇ curl -X GET "https://evoapi.automatesolutions.tech/instance/fetchInstances" \                                                          ‚îÇ
‚îÇ   -H "apikey: 87209ff5c799c486209ba98cd077bc77"                                                                                        ‚îÇ
‚îÇ ```                                                                                                                                    ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ **Hallazgo:**                                                                                                                          ‚îÇ
‚îÇ ```json                                                                                                                                ‚îÇ
‚îÇ {                                                                                                                                      ‚îÇ
‚îÇ   "Chatwoot": {                                                                                                                        ‚îÇ
‚îÇ     "enabled": false,  // ‚ùå PROBLEMA INICIAL                                                                                           ‚îÇ
‚îÇ     "accountId": "1",                                                                                                                  ‚îÇ
‚îÇ     "token": "maTyFdUJpnUfP3uXJQJDjDmQ"                                                                                                ‚îÇ
‚îÇ   }                                                                                                                                    ‚îÇ
‚îÇ }                                                                                                                                      ‚îÇ
‚îÇ ```                                                                                                                                    ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ **Acci√≥n tomada:** Habilitar Chatwoot en la instancia                                                                                  ‚îÇ
‚îÇ ```bash                                                                                                                                ‚îÇ
‚îÇ curl -X POST "https://evoapi.automatesolutions.tech/chatwoot/set/AIC_test" \                                                           ‚îÇ
‚îÇ   -H "apikey: 87209ff5c799c486209ba98cd077bc77" \                                                                                      ‚îÇ
‚îÇ   -H "Content-Type: application/json" \                                                                                                ‚îÇ
‚îÇ   -d '{                                                                                                                                ‚îÇ
‚îÇ     "enabled": true,                                                                                                                   ‚îÇ
‚îÇ     "accountId": "1",                                                                                                                  ‚îÇ
‚îÇ     "token": "maTyFdUJpnUfP3uXJQJDjDmQ",                                                                                               ‚îÇ
‚îÇ     "url": "https://chatwoot.automatesolutions.tech",                                                                                  ‚îÇ
‚îÇ     "signMsg": false,                                                                                                                  ‚îÇ
‚îÇ     "reopenConversation": true,                                                                                                        ‚îÇ
‚îÇ     "conversationPending": false                                                                                                       ‚îÇ
‚îÇ   }'                                                                                                                                   ‚îÇ
‚îÇ ```                                                                                                                                    ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ **Resultado:** ‚úÖ Integraci√≥n habilitada, pero mensajes a√∫n no aparecen en UI                                                           ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ ---                                                                                                                                    ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ ### Paso 2: Verificar logs de Evolution API                                                                                            ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ **Comando:**                                                                                                                           ‚îÇ
‚îÇ ```bash                                                                                                                                ‚îÇ
‚îÇ docker service logs evolution_evolution_api --tail 50 | grep -i chatwoot                                                               ‚îÇ
‚îÇ ```                                                                                                                                    ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ **Hallazgos importantes:**                                                                                                             ‚îÇ
‚îÇ ```log                                                                                                                                 ‚îÇ
‚îÇ [ChatwootService] New message received - Instance: AIC_test                                                                            ‚îÇ
‚îÇ [ChatwootService] Creating conversation                                                                                                ‚îÇ
‚îÇ [ChatwootService] New conversation created of 573022734929@s.whatsapp.net with ID: 7                                                   ‚îÇ
‚îÇ [ChatwootService] Contact ID: 3                                                                                                        ‚îÇ
‚îÇ ```                                                                                                                                    ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ **Conclusi√≥n:** ‚úÖ Evolution API est√° enviando mensajes correctamente a Chatwoot                                                        ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ ---                                                                                                                                    ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ ### Paso 3: Verificar datos en la base de datos                                                                                        ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ **Consulta SQL - Verificar mensajes:**                                                                                                 ‚îÇ
‚îÇ ```sql                                                                                                                                 ‚îÇ
‚îÇ SELECT id, content, created_at, inbox_id, conversation_id, sender_type                                                                 ‚îÇ
‚îÇ FROM messages                                                                                                                          ‚îÇ
‚îÇ WHERE inbox_id = 2                                                                                                                     ‚îÇ
‚îÇ ORDER BY created_at DESC                                                                                                               ‚îÇ
‚îÇ LIMIT 10;                                                                                                                              ‚îÇ
‚îÇ ```                                                                                                                                    ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ **Resultado:**                                                                                                                         ‚îÇ
‚îÇ ```                                                                                                                                    ‚îÇ
‚îÇ  id |  content  |      created_at         | inbox_id | conversation_id | sender_type                                                   ‚îÇ
‚îÇ ----+-----------+-------------------------+----------+-----------------+-------------                                                  ‚îÇ
‚îÇ  14 | Hola      | 2025-11-06 03:04:56.803 |        2 |               7 | Contact                                                       ‚îÇ
‚îÇ  13 | G         | 2025-11-06 03:01:54.346 |        2 |               5 | Contact                                                       ‚îÇ
‚îÇ  10 | H         | 2025-11-06 02:52:27.381 |        2 |               5 | Contact                                                       ‚îÇ
‚îÇ ```                                                                                                                                    ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ **Conclusi√≥n:** ‚úÖ Los mensajes S√ç est√°n en la base de datos                                                                            ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ ---                                                                                                                                    ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ **Consulta SQL - Verificar estado de conversaciones:**                                                                                 ‚îÇ
‚îÇ ```sql                                                                                                                                 ‚îÇ
‚îÇ SELECT id, status, account_id, inbox_id, created_at                                                                                    ‚îÇ
‚îÇ FROM conversations                                                                                                                     ‚îÇ
‚îÇ WHERE inbox_id = 2                                                                                                                     ‚îÇ
‚îÇ ORDER BY updated_at DESC;                                                                                                              ‚îÇ
‚îÇ ```                                                                                                                                    ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ **Resultado:**                                                                                                                         ‚îÇ
‚îÇ ```                                                                                                                                    ‚îÇ
‚îÇ  id | status | account_id | inbox_id |      created_at                                                                                 ‚îÇ
‚îÇ ----+--------+------------+----------+-------------------------                                                                        ‚îÇ
‚îÇ   7 |      2 |          1 |        2 | 2025-11-06 03:04:56.735                                                                         ‚îÇ
‚îÇ   5 |      2 |          1 |        2 | 2025-11-06 02:52:27.315                                                                         ‚îÇ
‚îÇ   3 |      0 |          1 |        2 | 2025-11-06 02:07:11.655                                                                         ‚îÇ
‚îÇ ```                                                                                                                                    ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ **Hallazgo cr√≠tico:** Status = 2 (PENDING) - Las conversaciones est√°n en estado "pending"                                              ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ ---                                                                                                                                    ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ ### Paso 4: Verificar API de Chatwoot                                                                                                  ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ **Comando:**                                                                                                                           ‚îÇ
‚îÇ ```bash                                                                                                                                ‚îÇ
‚îÇ curl -s -X GET "https://chatwoot.automatesolutions.tech/api/v1/accounts/1/conversations?status=all&inbox_id=2" \                       ‚îÇ
‚îÇ   -H "api_access_token: maTyFdUJpnUfP3uXJQJDjDmQ"                                                                                      ‚îÇ
‚îÇ ```                                                                                                                                    ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ **Resultado:**                                                                                                                         ‚îÇ
‚îÇ ```json                                                                                                                                ‚îÇ
‚îÇ {                                                                                                                                      ‚îÇ
‚îÇ   "data": {                                                                                                                            ‚îÇ
‚îÇ     "meta": {                                                                                                                          ‚îÇ
‚îÇ       "unassigned_count": 4,                                                                                                           ‚îÇ
‚îÇ       "all_count": 4                                                                                                                   ‚îÇ
‚îÇ     },                                                                                                                                 ‚îÇ
‚îÇ     "payload": [                                                                                                                       ‚îÇ
‚îÇ       {                                                                                                                                ‚îÇ
‚îÇ         "id": 7,                                                                                                                       ‚îÇ
‚îÇ         "status": "pending",                                                                                                           ‚îÇ
‚îÇ         "messages": [                                                                                                                  ‚îÇ
‚îÇ           {                                                                                                                            ‚îÇ
‚îÇ             "content": "Hola",                                                                                                         ‚îÇ
‚îÇ             "sender_type": "Contact"                                                                                                   ‚îÇ
‚îÇ           }                                                                                                                            ‚îÇ
‚îÇ         ]                                                                                                                              ‚îÇ
‚îÇ       }                                                                                                                                ‚îÇ
‚îÇ     ]                                                                                                                                  ‚îÇ
‚îÇ   }                                                                                                                                    ‚îÇ
‚îÇ }                                                                                                                                      ‚îÇ
‚îÇ ```                                                                                                                                    ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ **Conclusi√≥n:** ‚úÖ La API de Chatwoot muestra las conversaciones correctamente                                                          ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ ---                                                                                                                                    ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ ### Paso 5: Investigaci√≥n en GitHub y documentaci√≥n oficial                                                                            ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ **Issues revisados:**                                                                                                                  ‚îÇ
‚îÇ 1. [EvolutionAPI #2002](https://github.com/EvolutionAPI/evolution-api/issues/2002) - Messages not appearing as Open                    ‚îÇ
‚îÇ 2. [Chatwoot #12131](https://github.com/chatwoot/chatwoot/issues/12131) - Messages in DB but not showing in UI                         ‚îÇ
‚îÇ 3. [EvolutionAPI #1446](https://github.com/EvolutionAPI/evolution-api/issues/1446) - Messages not reaching Chatwoot                    ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ **Hallazgo clave de GitHub Issue #12131:**                                                                                             ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ > **Usuario:** "Messages are saved in database but don't show in UI"                                                                   ‚îÇ
‚îÇ >                                                                                                                                      ‚îÇ
‚îÇ > **sojan-official (Chatwoot oficial):** "Do you have an agent bot / captain or any similar integration associated to these inboxes?   ‚îÇ
‚îÇ In such cases conversations will be created in pending status during triage."                                                          ‚îÇ
‚îÇ >                                                                                                                                      ‚îÇ
‚îÇ > **Usuario (soluci√≥n):** "Thanks, I didn't think about the filters. It actually works."                                               ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ **Hip√≥tesis:** El problema est√° relacionado con Agent Bots activos en el inbox                                                         ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ ---                                                                                                                                    ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ ### Paso 6: Verificar Agent Bots en el inbox                                                                                           ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ **Consulta SQL:**                                                                                                                      ‚îÇ
‚îÇ ```sql                                                                                                                                 ‚îÇ
‚îÇ SELECT abi.id, abi.inbox_id, abi.agent_bot_id, ab.name as bot_name, ab.bot_type                                                        ‚îÇ
‚îÇ FROM agent_bot_inboxes abi                                                                                                             ‚îÇ
‚îÇ LEFT JOIN agent_bots ab ON abi.agent_bot_id = ab.id                                                                                    ‚îÇ
‚îÇ WHERE abi.inbox_id = 2;                                                                                                                ‚îÇ
‚îÇ ```                                                                                                                                    ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ **Resultado:**                                                                                                                         ‚îÇ
‚îÇ ```                                                                                                                                    ‚îÇ
‚îÇ  id | inbox_id | agent_bot_id | bot_name  | bot_type                                                                                   ‚îÇ
‚îÇ ----+----------+--------------+-----------+----------                                                                                  ‚îÇ
‚îÇ   2 |        2 |            1 | ROCKSPACE |        0                                                                                   ‚îÇ
‚îÇ ```                                                                                                                                    ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ **‚úÖ CAUSA RA√çZ ENCONTRADA:** Hay un Agent Bot llamado "ROCKSPACE" activo en el inbox 2                                                 ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ ---                                                                                                                                    ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ ## üéØ Causa Ra√≠z                                                                                                                       ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ ### Explicaci√≥n t√©cnica:                                                                                                               ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ Cuando un **Agent Bot** est√° asociado a un inbox en Chatwoot:                                                                          ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ 1. Las conversaciones entrantes se crean autom√°ticamente con `status = 2` (PENDING)                                                    ‚îÇ
‚îÇ 2. El bot procesa la conversaci√≥n en un estado de "triaje"                                                                             ‚îÇ
‚îÇ 3. **La interfaz de Chatwoot oculta por defecto las conversaciones en estado PENDING**                                                 ‚îÇ
‚îÇ 4. El usuario necesita ajustar los filtros de vista para ver estas conversaciones                                                      ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ ### Estados de conversaci√≥n en Chatwoot:                                                                                               ‚îÇ
‚îÇ - `0` = OPEN (visible por defecto)                                                                                                     ‚îÇ
‚îÇ - `1` = RESOLVED (cerrada)                                                                                                             ‚îÇ
‚îÇ - `2` = PENDING (oculta por defecto cuando hay Agent Bot)                                                                              ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ ### Flujo del problema:                                                                                                                ‚îÇ
‚îÇ ```                                                                                                                                    ‚îÇ
‚îÇ WhatsApp ‚Üí Evolution API ‚Üí Chatwoot API ‚Üí Base de datos (status: PENDING)                                                              ‚îÇ
‚îÇ                                                ‚Üì                                                                                       ‚îÇ
‚îÇ                                         Agent Bot "ROCKSPACE"                                                                          ‚îÇ
‚îÇ                                                ‚Üì                                                                                       ‚îÇ
‚îÇ                                         UI OCULTA conversaci√≥n                                                                         ‚îÇ
‚îÇ ```                                                                                                                                    ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ ---                                                                                                                                    ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ ## ‚úÖ Soluci√≥n                                                                                                                          ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ ### Opci√≥n 1: Desactivar el Agent Bot (Si no se necesita)                                                                              ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ **SQL:**                                                                                                                               ‚îÇ
‚îÇ ```sql                                                                                                                                 ‚îÇ
‚îÇ DELETE FROM agent_bot_inboxes                                                                                                          ‚îÇ
‚îÇ WHERE inbox_id = 2 AND agent_bot_id = 1;                                                                                               ‚îÇ
‚îÇ ```                                                                                                                                    ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ **Bash:**                                                                                                                              ‚îÇ
‚îÇ ```bash                                                                                                                                ‚îÇ
‚îÇ docker exec $(docker ps | grep pgvector | awk '{print $1}') \                                                                          ‚îÇ
‚îÇ   psql -U postgres -d chatwoot \                                                                                                       ‚îÇ
‚îÇ   -c "DELETE FROM agent_bot_inboxes WHERE inbox_id = 2 AND agent_bot_id = 1;"                                                          ‚îÇ
‚îÇ ```                                                                                                                                    ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ **Resultado:** Las nuevas conversaciones se crear√°n con status = OPEN y aparecer√°n inmediatamente                                      ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ ---                                                                                                                                    ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ ### Opci√≥n 2: Ajustar filtros en Chatwoot UI (Mantener el bot activo)                                                                  ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ **Pasos en la interfaz:**                                                                                                              ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ 1. Ir a: `https://chatwoot.automatesolutions.tech/app/accounts/1/inbox/2`                                                              ‚îÇ
‚îÇ 2. En la barra lateral izquierda, hacer clic en:                                                                                       ‚îÇ
‚îÇ    - **"All Conversations"** (Todas las conversaciones)                                                                                ‚îÇ
‚îÇ    - O **"Unassigned"** (Sin asignar)                                                                                                  ‚îÇ
‚îÇ 3. **NO estar en "Mine"** (M√≠os) - solo muestra conversaciones asignadas                                                               ‚îÇ
‚îÇ 4. Buscar un toggle o filtro que diga:                                                                                                 ‚îÇ
‚îÇ    - "Show pending conversations" / "Mostrar conversaciones pendientes"                                                                ‚îÇ
‚îÇ    - "Include bot triaged conversations"                                                                                               ‚îÇ
‚îÇ 5. Activarlo                                                                                                                           ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ ---                                                                                                                                    ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ ### Opci√≥n 3: Reasignar conversaciones manualmente (Temporal)                                                                          ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ **SQL:**                                                                                                                               ‚îÇ
‚îÇ ```sql                                                                                                                                 ‚îÇ
‚îÇ UPDATE conversations                                                                                                                   ‚îÇ
‚îÇ SET status = 0, assignee_id = 1                                                                                                        ‚îÇ
‚îÇ WHERE inbox_id = 2 AND status = 2;                                                                                                     ‚îÇ
‚îÇ ```                                                                                                                                    ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ **Nota:** Esta soluci√≥n es temporal. Las nuevas conversaciones seguir√°n cre√°ndose en estado PENDING.                                   ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ ---                                                                                                                                    ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ ### Opci√≥n 4: Desactivar el bot desde Chatwoot UI                                                                                      ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ **Pasos:**                                                                                                                             ‚îÇ
‚îÇ 1. Settings ‚Üí Inboxes ‚Üí Seleccionar "AIC_test" (inbox 2)                                                                               ‚îÇ
‚îÇ 2. Ir a la pesta√±a "Collaborators" o "Agent Bots"                                                                                      ‚îÇ
‚îÇ 3. Desactivar o eliminar el bot "ROCKSPACE"                                                                                            ‚îÇ
‚îÇ 4. Guardar cambios                                                                                                                     ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ ---                                                                                                                                    ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ ## üõ°Ô∏è Prevenci√≥n                                                                                                                      ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ ### Checklist para futuras integraciones Evolution + Chatwoot:                                                                         ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ - [ ] Verificar si hay Agent Bots activos en el inbox                                                                                  ‚îÇ
‚îÇ - [ ] Si hay bots, configurar Evolution con `conversationPending: false`                                                               ‚îÇ
‚îÇ - [ ] Alternativamente, ajustar filtros en Chatwoot UI para mostrar conversaciones pending                                             ‚îÇ
‚îÇ - [ ] Documentar la presencia de bots en la configuraci√≥n del proyecto                                                                 ‚îÇ
‚îÇ - [ ] Revisar regularmente los estados de conversaciones en la base de datos                                                           ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ ### Comandos √∫tiles de verificaci√≥n:                                                                                                   ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ **1. Verificar Agent Bots activos:**                                                                                                   ‚îÇ
‚îÇ ```sql                                                                                                                                 ‚îÇ
‚îÇ SELECT i.name as inbox_name, ab.name as bot_name, ab.bot_type                                                                          ‚îÇ
‚îÇ FROM agent_bot_inboxes abi                                                                                                             ‚îÇ
‚îÇ JOIN inboxes i ON abi.inbox_id = i.id                                                                                                  ‚îÇ
‚îÇ JOIN agent_bots ab ON abi.agent_bot_id = ab.id;                                                                                        ‚îÇ
‚îÇ ```                                                                                                                                    ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ **2. Ver distribuci√≥n de estados de conversaciones:**                                                                                  ‚îÇ
‚îÇ ```sql                                                                                                                                 ‚îÇ
‚îÇ SELECT inbox_id, status, COUNT(*) as count                                                                                             ‚îÇ
‚îÇ FROM conversations                                                                                                                     ‚îÇ
‚îÇ GROUP BY inbox_id, status                                                                                                              ‚îÇ
‚îÇ ORDER BY inbox_id, status;                                                                                                             ‚îÇ
‚îÇ ```                                                                                                                                    ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ **3. Verificar configuraci√≥n de Evolution:**                                                                                           ‚îÇ
‚îÇ ```bash                                                                                                                                ‚îÇ
‚îÇ curl -X GET "https://evoapi.automatesolutions.tech/instance/fetchInstances" \                                                          ‚îÇ
‚îÇ   -H "apikey: TU_API_KEY" | jq '.[] | {name: .name, chatwoot: .Chatwoot}'                                                              ‚îÇ
‚îÇ ```                                                                                                                                    ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ ---                                                                                                                                    ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ ## üìö Referencias                                                                                                                      ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ ### Issues de GitHub:                                                                                                                  ‚îÇ
‚îÇ - [Chatwoot #12131 - Messages in DB but not showing in UI](https://github.com/chatwoot/chatwoot/issues/12131) ‚≠ê **Caso exacto**        ‚îÇ
‚îÇ - [EvolutionAPI #2002 - Messages not appearing as Open](https://github.com/EvolutionAPI/evolution-api/issues/2002)                     ‚îÇ
‚îÇ - [EvolutionAPI #1446 - Messages not reaching Chatwoot](https://github.com/EvolutionAPI/evolution-api/issues/1446)                     ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ ### Documentaci√≥n oficial:                                                                                                             ‚îÇ
‚îÇ - [Evolution API - Chatwoot Integration](https://doc.evolution-api.com/v2/en/integrations/chatwoot)                                    ‚îÇ
‚îÇ - [Chatwoot - Creating API Channel                                                                                                     ‚îÇ
‚îÇ Inbox](https://www.chatwoot.com/hc/user-guide/articles/1677839703-how-to-create-an-api-channel-inbox)                                  ‚îÇ
‚îÇ - [Chatwoot Developer Docs - Common Errors](https://developers.chatwoot.com/contributing-guide/common-errors)                          ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ ### Estados de conversaci√≥n en Chatwoot:                                                                                               ‚îÇ
‚îÇ | C√≥digo | Estado   | Descripci√≥n                           |                                                                          ‚îÇ
‚îÇ |--------|----------|---------------------------------------|                                                                          ‚îÇ
‚îÇ | 0      | OPEN     | Conversaci√≥n abierta y visible        |                                                                          ‚îÇ
‚îÇ | 1      | RESOLVED | Conversaci√≥n cerrada/resuelta         |                                                                          ‚îÇ
‚îÇ | 2      | PENDING  | En triaje (oculta si hay Agent Bot)   |                                                                          ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ ---                                                                                                                                    ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ ## üìä Resumen Ejecutivo                                                                                                                ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ **Problema:** Mensajes no aparecen en Chatwoot UI                                                                                      ‚îÇ
‚îÇ **Causa:** Agent Bot "ROCKSPACE" activo causa conversaciones en estado PENDING (ocultas por defecto)                                   ‚îÇ
‚îÇ **Soluci√≥n:** Desactivar Agent Bot o ajustar filtros de vista en UI                                                                    ‚îÇ
‚îÇ **Tiempo de resoluci√≥n:** ~2 horas de troubleshooting                                                                                  ‚îÇ
‚îÇ **Lecci√≥n aprendida:** Siempre verificar Agent Bots antes de diagnosticar problemas de integraci√≥n                                     ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ ---                                                                                                                                    ‚îÇ
‚îÇ                                                                                                                                        ‚îÇ
‚îÇ **Documentado por:** Claude Code                                                                                                       ‚îÇ
‚îÇ **√öltima actualizaci√≥n:** 2025-11-06                                                                                                   ‚îÇ
‚îÇ                                        